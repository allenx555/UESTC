# 计算机组成原理

## 概述

冯诺依曼思想：信息的二进制表示、存储程序机制、硬件组成：运算器、控制器、存储器、输入设备、输出设备

## 计算机的信息表示

1位（b）=1比特（bit）；1字节（B，Byte）=8位；1字=16位=2字节

原码：符号位 + | 真值 |

补码：符号位 + (正数 |  |真值| : 真值按位取反末位加1)

浮点数机器格式：<img src="C:\Users\allen\AppData\Roaming\Typora\typora-user-images\image-20200107104215264.png" alt="image-20200107104215264" style="zoom:50%;" />

规格化：尾数最高位，原码 1；补码正数 1

IEEE754：

<img src="C:\Users\allen\AppData\Roaming\Typora\typora-user-images\image-20200107104448128.png" alt="image-20200107104448128" style="zoom:50%;" />

### 溢出

溢出判断表达式： 
“溢出”=![image-20200107105701793](C:\Users\allen\AppData\Roaming\Typora\typora-user-images\image-20200107105701793.png)

“溢出”=![image-20200107105708327](C:\Users\allen\AppData\Roaming\Typora\typora-user-images\image-20200107105708327.png)

“溢出”=![image-20200107105714627](C:\Users\allen\AppData\Roaming\Typora\typora-user-images\image-20200107105714627.png)

### 对阶

目的：使被加数和加数的小数点对齐，即使其阶码相等

原则：小阶向大阶看齐

原因：如果大阶向小阶看齐，随阶码的值减少，为保持数的值不变，则尾数必须左移相应位数，有可能发生符号位及尾数低位的丢失，这只影响精度不会产生错误。

## CPU概述

### CPU硬件结构模型

MAR：地址寄存器

MDR：主存数据寄存器

IR：指令寄存器

PC：程序计数器，可编程

SP：栈顶指针，可编程

PSW：程序状态字，可编程

地址总线：MAR指向，指向M，接口互相指向

数据总线：MDR互相指向，M互相指向，指向IR，接口互相指向

控制总线：控制逻辑互相指向，M互相指向，接口互相指向



运算器的核心部件是 ALU，一般应具有算术运算与逻辑运算两大类运算能力

### 寻址

寄存器寻址 R

寄存器间址 (R)

自增/自减型寄存器间址 (R)+ -(R)

直接/自增型双间址 @(R)+

变址/相对寻址 X(R)

### 控制部件

控制部件的输入信号包括：IR、PSW、PC、时序系统、I/O请求、复位信号

控制器分为：组合逻辑控制器和微程序控制器

一般指令的读取和执行分为：取指令、取源操作数、取目的操作数、执行阶段

### 时序部件

时序信号：周期、节拍、脉冲

时序系统：产生时序信号的部件，由1个低频振荡器和倍频逻辑组成

指令周期、工作周期、总线周期、时钟周期、时钟信号

同步控制、异步控制、扩展同步控制

#### 组合逻辑控制

由硬连逻辑电路产生微命令的方式称为组合逻辑控制方式

三级时序系统：工作周期、时钟周期、工作脉冲

工作周期：取指周期 FT、源周期 ST、目的周期、执行周期、 中断周期 IT、DMA 周期 DMAT

#### 微程序控制

由微指令译码产生微命令的方式称为微程序控制方式

微程序编码方式：直接表示法，编码表示法，混合表示法

初始微地址的形成：取机器指令；功能转移

后续微地址：增量方式（顺序控制方式相似）；断定方式（按照目的操作数寻址方式）

相比较优点：组合逻辑（三级时序）控制器速度快，但控制较复杂，且功能扩展较难。微程序控制器有规整性、可维护性的优点。他是一种利用软件设计硬件的技术，可实现复杂指令的操作控制。另外，微程序设计便于计算机功能的扩充，可较方便地增加和修改指令，只需增加或修改一些微程序

### 同步控制与异步控制

|      | 同步控制                                                     | 异步控制                                     |
| ---- | ------------------------------------------------------------ | -------------------------------------------- |
| 定义 | 各项操作受统一时序控制                                       | 各项操作按不同需要安排时间，不受统一时序控制 |
| 优点 | 时序关系简单，时序划分规整，控制不复杂；控制逻辑易于集中，便于管理 | 时间安排紧凑合理                             |
| 缺点 | 时间安排不合理                                               | 控制复杂                                     |
| 场景 | 用于CPU内部、设备内部、系统总线操作                          | 用于异步总线操作                             |

两者最核心的区别：有无统一时序划分

### 其他

主设备：申请并掌握总线权的设备

从设备：响应主设备请求的设备

总线周期：经总线传送一次数据所用的时间

## 存储子系统

主存：CPU 可直接访问，存放 CPU 当前使用的指令和数据，特点是能随机访问、工作 速度快、容量有限

 辅存（外存）：存放大量的后备程序和数据，特点：速度较慢、容量大

高速缓冲存储器(Cache)：存放 CPU 在当前一小段时间内多次使用的程序和数据，以缓解 CPU 和主存的速度差异，特点：速度很快、容量小

静态存储器：利用双稳态触发器存储信息

动态存储器：依靠电容上的电荷暂存信息

磁表面存储器：磁带、存盘、硬盘

片选信号：CSi

片选信号低电平有效 

存储器分类（存取方式）：随机存取存储器，顺序存取存储器（SAM），直接存取存储器（DAM）

刷新：由于存储元电路存在漏电流，使栅极电容上的电荷流失，因此必须每隔一定时间对存储体中的所有记忆单元的栅极电容补充电荷

刷新控制方式：集中刷新方式、分散刷新方式、异步刷新方式

刷新与重写的区别：重写随机，刷新定时；重写按存储单元进行，刷新按存储体一行行进行

重写：破坏性读出需重写，即静态存储器与有VCC供电的动态存储器无需重写，无VCC单管单元需重写

## I/O子系统

信息传送的控制方式：程序查询方式、中断方式、DMA方式和通道方式。程序查询方式CPU效率最低

### 中断

中断的实质是程序切换

步骤：中断请求、中断判优、中断响应、中断处理、中断返回

进入中断响应周期：关中断、保存断点、获得服务程序的入口、转向程序运行状态，以开始执行中断服务程序（直接依靠硬件实现的）

响应中断条件：外设有请求，且未被屏蔽；CPU开中断；中断源优先级高于当前程序的优先级；一条指令(非停机)结束，即ET之后

中断优先权控制电路的功能：当同时有若干个中断请求时，选优先权最高的中断请求送CPU

响应中断请求：在一条指令结束时响应中断请求

中断屏蔽：送屏蔽字

中断允许：开/关中断

单级中断：保护现场、中断服务处理、恢复现场、开中断、返回。

多重中断：保护现场、送屏蔽字和开中断、中断服务处理、关中断、恢复现场及屏蔽字、开中断、返回

中断程序的入口地址：

（a）非向量中断：将服务程序入口组织在查询程序中，CPU响应时，执行查询程序，查询中断源，转入相应的服务程序。

（b）向量中断：将中断源的服务程序入口（中断向量）组织在中断向量表中，CPU响应时，由硬件直接产生相应的向量地址，按地址查表，取得服务程序入口，转入相应的服务程序

#### 中断判优

优先顺序: 

（1）故障、内中断、DMA、外中断；高速操作优于低速操作，输入优于输出。

（2）CPU现行程序与外设请求的判优

​	（a）CPU设置允许中断标志

​	（b）CPU设置程序状态字的优先级字段，为现行程序赋予优先级

中断接口判优：中断请求寄存器、中断屏蔽寄存器、中断服务寄存器，判断是否发出INT请求

### DMA

直接依靠硬件系统来控制主存与设备之间的数据传送,传送期间无需CPU干预，传送结束后通常用中断方式通知CPU

DMA初始化信息：传送操作类型、主存首址、交换量、外设寻址信息

数据传送模式：单字传送、成组连续传送方式

应用：主存与高速I/O设备之间的简单数据传送、大批量数据采集系统、动态存储器（DRAM）的自动刷新

特点：响应随机请求、一般不影响CPU程序的执行，仅占用总线、无程序切换、大批量数据的简单传送

(2)一般不影响CPU程序的执行，仅占用总线、无程序切换大批量数据的简单传送

DMA响应时机：一个总线周期结束时响应DMA请求

DMA传送的3个阶段：停止CPU访内存、周期挪用、DMA与CPU交替访问内存

初始化DMA步骤：向接口送出I/O设备的寻址信息；向DMA控制器送出控制字，如传送方向；向DMA控制器送出主存缓冲区首址；向DMA控制器送出传送的数据量；

DMA控制器功能：

①接收初始化信息（传送方向、主存首址、交换量）

②接收外设DMA请求，判优，向CPU申请总线。

③接管总线权，发地址、读/写命令。

接口功能：

①接收初始化信息(外设寻址信息）

②向DMA控制器发请求。

③传送数据。

#### 其他

传送发生在I/O与主存之间;

由DMA控制器来控制传送,DMA控制器接管总线权,传送完毕再将总线权交还CPU

只要CPU不访存, DMA操作与CPU可并行操作

传送前和传送后需要CPU程序干预

1、停止CPU访内存

2、周期挪用

3、DMA与CPU交替访问内存

### 中断与子程序调用比较

（1）子程序的执行由程序员事先安排,而中断服务程序的执行则是由随机中断事件触发。

（2）子程序的执行受主程序或上层程序控制,而中断服务程序一般与被中断的现行程序无关。

（3）一般不存在同时调用多个子程序的情况,但可能发生多个外设同时向CPU发出中断服务请求的情况

### 中断与DMA比较

相同点：能响应随机请求；可并行操作。

区别：中断用程序实现中、低速I/O传送；能处理复杂事态；一条指令结束时响应请求，其实质是程序切换；DMA用硬件实现高速、简单I/O传送；一个总线周期结束时响应请求，其实质是总线权切换

### 其他

接口分类：数据传送格式——并行、串行；时序——同步、异步；传送控制——程序控制接口、中断接口、DMA接口

总线：一组能为多个部件分时共享的信息传送线路

总线实体：一组传送线与相应控制逻辑

系统总线传送的信息类型(数据、地址、控制)

分类：异步总线、同步总线、扩展同步总线

#### 为什么在外设与 CPU 之间需要接口?

（1）时间同步：不同速度外设如何与 CPU 之间进行时间同步 （2）数据格式的转换(如果需要)：外设数据格式可能与 CPU 数据格式不同 （3）CPU 与外设之间一次数据传送量的控制 （4）其它因素(如电平转换)

## 显示设备

### 字符/数字(A/N)方式

行高列低

显示缓冲存储器内容：字符的编码(ASCII码) 

基本显示缓存容量：帧 行 × 列 B

字符发生器容量：字符数 × 纵点（线数） B

4级计数器：

- 点计数：区间横点 : 1
- 字符计数：(列 + L) : 1
- 线计数：区间纵点 : 1
- 行计数：(行 + m) : 1

### 图形(APA)方式

显示缓冲存储器内容：图形像素点的颜色代码

显示缓冲存储器容量：点 × 线 × 色数位数/8 B

3级计数器：

- 点计数器：8 : 1
- 字节计数器：(横向点 / 8 + L ) : 1
- 线计数器：(纵向点 + L) : 1

刷新所需带宽 = 分辨率 × 每个像素点颜色深度 × 刷新速度
